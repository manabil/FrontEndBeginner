const books=[],RENDER_EVENT="render-book",STORAGE_KEY="CATALOG_APPS";let isSorted=!1;function findBookIndex(e){for(let t in books)if(books[t].id===e)return t;return!1}function addBook(){var e,t,a,n,o;let l=+new Date,i=document.getElementById("inputJudul").value+"  ",s=document.getElementById("inputPenulis").value,u=document.getElementById("inputTahun").value,d="true"===document.querySelector('input[name="inputStatusBuku"]:checked').value,r=(e=l,t=i,a=s,n=u,o=d,{id:e,title:t,author:a,year:n,isCompleted:o});books.push(r),toastNotification(),document.dispatchEvent(new Event(RENDER_EVENT)),saveData()}function editBook(e){let t=document.getElementById("inputJudul").value,a=document.getElementById("inputPenulis").value,n=document.getElementById("inputTahun").value,o="true"===document.querySelector('input[name="inputStatusBuku"]:checked').value,l=findBookIndex(e);books[l].title=t+" ",books[l].author=a,books[l].year=n,books[l].isCompleted=o,Swal.fire({title:"Apakah anda yakin mengubah buku ini ?",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Batal",icon:"warning"}).then(e=>{e.isConfirmed&&(toastNotification("edit"),saveData())})}function manipulateBook(e){function t(e){for(let t of books)if(t.id===e)return t;return null}let a=document.createElement("h2"),n=document.createElement("p"),o=document.createElement("p");a.innerText=e.title,o.innerText=e.author,n.innerText=e.year,n.style.fontWeight=900,n.style.fontSize="17px",n.style.marginBottom="15px";let l=document.createElement("div"),i=document.createElement("div");l.classList.add("book-info"),i.classList.add("book-action"),l.append(a,n,o);let s=document.createElement("div");s.classList.add("book-card"),s.append(l);let u=document.createElement("i"),d=document.createElement("i"),r=document.createElement("i"),c=document.createElement("i"),p=document.createElement("i");u.classList.add("fa","fa-light","fa-book-open","fa-2xl"),d.classList.add("fa","fa-thin","fa-book","fa-2xl"),r.classList.add("fa","fa-regular","fa-pen-to-square","fa-2xl"),c.classList.add("fa","fa-regular","fa-trash","fa-2xl"),p.classList.add("fa","fa-light","fa-circle-check");let m=document.createElement("button"),E=document.createElement("button");if(m.title="Edit Book",E.title="Delete Book",m.append(r),E.append(c),m.addEventListener("click",()=>{window.open(`tambah.html?book=${e.id}`,"_parent")}),E.addEventListener("click",()=>{Swal.fire({title:"Apakah anda ingin menghapus buku ini ?",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Batal",icon:"warning"}).then(t=>{t.isConfirmed&&(toastNotification("hapus",e),function e(t){let a=findBookIndex(t);a&&(books.splice(a,1),document.dispatchEvent(new Event(RENDER_EVENT)),saveData())}(e.id))})}),e.isCompleted){let k=document.createElement("span"),f=document.createElement("button");k.style.color="green",f.title="Uncomplete Read",k.append(p),a.append(k),f.append(d),f.addEventListener("click",()=>{(function e(a){let n=t(a);null!=n&&(n.isCompleted=!1,document.dispatchEvent(new Event(RENDER_EVENT)),saveData())})(e.id),toastNotification("ubah",e)}),i.append(f,m,E),s.append(i)}else{let b=document.createElement("button");b.title="Complete Read",b.append(u),b.addEventListener("click",()=>{(function e(a){let n=t(a);null!=n&&(n.isCompleted=!0,document.dispatchEvent(new Event(RENDER_EVENT)),saveData())})(e.id),toastNotification("ubah",e)}),i.append(b,m,E),s.append(i)}return s}function saveData(){if(isStorageExist()){let e=JSON.stringify(books);localStorage.setItem(STORAGE_KEY,e)}}function isStorageExist(){return!0}function loadDataFromStorage(){let e=localStorage.getItem(STORAGE_KEY),t=JSON.parse(e);if(null!==t)for(let a of t)books.push(a);document.dispatchEvent(new Event(RENDER_EVENT))}function toastNotification(e,t){"hapus"==e?tata.success("Buku telah berhasil dihapus",`Buku "${t.title}" telah dihapus`,{duration:5e3,animate:"slide"}):"ubah"==e?t.isCompleted?tata.success("Buku sudah dibaca",`Buku "${t.title}" telah dibaca`,{duration:5e3,animate:"slide"}):tata.warn("Buku belum dibaca",`Buku "${t.title}" belum dibaca`,{duration:5e3,animate:"slide"}):"edit"==e?tata.success("Buku berhasil diubah","Klik disini untuk melihat katalog",{duration:5e3,animate:"slide",onClick(){window.open("katalog.html")}}):tata.success("Buku berhasil ditambah","Klik disini untuk melihat katalog",{duration:5e3,animate:"slide",onClick(){window.open("katalog.html")}})}function searchBook(){let e=document.getElementById("searchInput").value.toLowerCase(),t=document.getElementsByClassName("book-item")[0];if(t.innerHTML="",""==e){document.dispatchEvent(new Event(RENDER_EVENT));return}let a=0;for(let n of books)if(n.title.toLowerCase().includes(e)||n.year.toLowerCase().includes(e)||n.author.toLowerCase().includes(e)){if(n.isCompleted){a+=1;let o=manipulateBook(n);t.append(o)}else{a+=1;let l=manipulateBook(n);t.append(l)}}if(!a){let i=document.createElement("h3");i.innerHTML="Tidak ditemukan buku ! </br> ❌",i.style.marginTop="50px",i.style.textAlign="center",i.style.fontWeight="bold",i.style.color="red",t.append(i),a=!1}}function getBook(e){let t=document.getElementsByName("saveButton")[0],a=document.getElementById("inputJudul"),n=document.getElementById("inputPenulis"),o=document.getElementById("inputTahun"),l=findBookIndex(e),i=books[l].title,s=books[l].author,u=books[l].year,d=books[l].isCompleted;a.value=i,n.value=s,o.value=u,d?document.getElementById("inputComplete").checked=!0:document.getElementById("inputUncomplete").checked=!0,t.value="Edit Buku"}function groupBook(){let e=document.getElementById("group-button");isSorted?(e.style.backgroundColor="white",e.style.color="black",isSorted=!1):(e.style.backgroundColor="#4154f1",e.style.color="white",isSorted=!0)}document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("form");if(isStorageExist()&&loadDataFromStorage(),null!=e){let t=new URLSearchParams(document.location.search);t.has("book")?(getBook(parseInt(t.get("book"))),e.addEventListener("submit",e=>{e.preventDefault(),editBook(parseInt(t.get("book")))})):e.addEventListener("submit",e=>{e.preventDefault(),addBook()})}}),document.getElementById("group-button").addEventListener("click",e=>{e.preventDefault(),groupBook(),document.dispatchEvent(new Event(RENDER_EVENT))}),document.getElementById("searchInput").addEventListener("keyup",e=>{e.preventDefault(),searchBook()}),document.getElementById("searchSubmit").addEventListener("submit",e=>{e.preventDefault(),searchBook()}),document.addEventListener(RENDER_EVENT,()=>{let e=document.getElementsByClassName("book-item")[0],t=document.getElementsByClassName("book-all")[0],a=document.getElementsByClassName("book-complete")[0],n=document.getElementsByClassName("book-uncomplete")[0],o=document.getElementsByClassName("book-complete-item")[0],l=document.getElementsByClassName("book-uncomplete-item")[0];if(e.innerHTML="",o.innerHTML="",l.innerHTML="",0==books.length){let i=document.getElementsByClassName("book-item")[0],s=document.createElement("h3");s.innerHTML="Isi buku terlebih dahulu ! </br> \uD83D\uDCDA\uD83D\uDCDA\uD83D\uDCDA",s.style.marginTop="50px",s.style.textAlign="center",s.style.fontWeight="bold",s.style.color="#263179",i.append(s)}if(isSorted)for(let u of(a.style.display="block",n.style.display="block",t.style.display="none",books)){let d=manipulateBook(u);u.isCompleted?o.append(d):l.append(d)}else for(let r of(a.style.display="none",n.style.display="none",t.style.display="block",books)){let c=manipulateBook(r);e.append(c)}});
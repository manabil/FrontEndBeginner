const books=[],RENDER_EVENT="render-book",STORAGE_KEY="CATALOG_APPS";function findBookIndex(e){for(let t in books)if(books[t].id===e)return t;return!1}function addBook(){var e,t,a,n,i;let o=+new Date,l=document.getElementById("inputJudul").value+"  ",s=document.getElementById("inputPenulis").value,u=document.getElementById("inputTahun").value,d="true"===document.querySelector('input[name="inputStatusBuku"]:checked').value,r=(e=o,t=l,a=s,n=u,i=d,{id:e,title:t,author:a,year:n,isCompleted:i});books.push(r),toastNotification(),document.dispatchEvent(new Event(RENDER_EVENT)),saveData()}function editBook(e){let t=document.getElementById("inputJudul").value,a=document.getElementById("inputPenulis").value,n=document.getElementById("inputTahun").value,i="true"===document.querySelector('input[name="inputStatusBuku"]:checked').value,o=findBookIndex(e);books[o].title=t+" ",books[o].author=a,books[o].year=n,books[o].isCompleted=i,Swal.fire({title:"Apakah anda yakin mengubah buku ini ?",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Batal",icon:"warning"}).then(e=>{e.isConfirmed&&(toastNotification("edit"),saveData())})}function manipulateBook(e){function t(e){for(let t of books)if(t.id===e)return t;return null}let a=document.createElement("h2"),n=document.createElement("p"),i=document.createElement("p");a.innerText=e.title,i.innerText=e.author,n.innerText=e.year,n.style.fontWeight=900,n.style.fontSize="17px",n.style.marginBottom="15px";let o=document.createElement("div"),l=document.createElement("div");o.classList.add("book-info"),l.classList.add("book-action"),o.append(a,n,i);let s=document.createElement("div");s.classList.add("book-card"),s.append(o);let u=document.createElement("i"),d=document.createElement("i"),r=document.createElement("i"),c=document.createElement("i"),p=document.createElement("i");u.classList.add("fa","fa-light","fa-book-open","fa-2xl"),d.classList.add("fa","fa-thin","fa-book","fa-2xl"),r.classList.add("fa","fa-regular","fa-pen-to-square","fa-2xl"),c.classList.add("fa","fa-regular","fa-trash","fa-2xl"),p.classList.add("fa","fa-light","fa-circle-check");let E=document.createElement("button"),m=document.createElement("button");if(E.title="Edit Book",m.title="Delete Book",E.append(r),m.append(c),E.addEventListener("click",()=>{window.open(`tambah.html?book=${e.id}`,"_parent")}),m.addEventListener("click",()=>{Swal.fire({title:"Apakah anda ingin menghapus buku ini ?",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Batal",icon:"warning"}).then(t=>{t.isConfirmed&&(toastNotification("hapus",e),function e(t){let a=findBookIndex(t);a&&(books.splice(a,1),document.dispatchEvent(new Event(RENDER_EVENT)),saveData())}(e.id))})}),e.isCompleted){let k=document.createElement("span"),f=document.createElement("button");k.style.color="green",f.title="Uncomplete Read",k.append(p),a.append(k),f.append(d),f.addEventListener("click",()=>{(function e(a){let n=t(a);null!=n&&(n.isCompleted=!1,document.dispatchEvent(new Event(RENDER_EVENT)),saveData())})(e.id),toastNotification("ubah",e)}),l.append(f,E,m),s.append(l)}else{let h=document.createElement("button");h.title="Complete Read",h.append(u),h.addEventListener("click",()=>{(function e(a){let n=t(a);null!=n&&(n.isCompleted=!0,document.dispatchEvent(new Event(RENDER_EVENT)),saveData())})(e.id),toastNotification("ubah",e)}),l.append(h,E,m),s.append(l)}return s}function saveData(){if(isStorageExist()){let e=JSON.stringify(books);localStorage.setItem(STORAGE_KEY,e)}}function isStorageExist(){return!0}function loadDataFromStorage(){let e=localStorage.getItem(STORAGE_KEY),t=JSON.parse(e);if(null!==t)for(let a of t)books.push(a);document.dispatchEvent(new Event(RENDER_EVENT))}function toastNotification(e,t){"hapus"==e?tata.success("Buku telah berhasil dihapus",`Buku "${t.title}" telah dihapus`,{duration:5e3,animate:"slide"}):"ubah"==e?t.isCompleted?tata.success("Buku sudah dibaca",`Buku "${t.title}" telah dibaca`,{duration:5e3,animate:"slide"}):tata.warn("Buku belum dibaca",`Buku "${t.title}" belum dibaca`,{duration:5e3,animate:"slide"}):"edit"==e?tata.success("Buku berhasil diubah","Klik disini untuk melihat katalog",{duration:5e3,animate:"slide",onClick(){window.open("katalog.html")}}):tata.success("Buku berhasil ditambah","Klik disini untuk melihat katalog",{duration:5e3,animate:"slide",onClick(){window.open("katalog.html")}})}function searchBook(){let e=document.getElementById("searchInput").value.toLowerCase(),t=document.getElementsByClassName("book-item")[0];if(t.innerHTML="",""==e){document.dispatchEvent(new Event(RENDER_EVENT));return}let a=0;for(let n of books)if(n.title.toLowerCase().includes(e)||n.year.toLowerCase().includes(e)||n.author.toLowerCase().includes(e)){if(n.isCompleted){a+=1;let i=manipulateBook(n);t.append(i)}else{a+=1;let o=manipulateBook(n);t.append(o)}}if(!a){let l=document.createElement("h3");l.innerHTML="Tidak ditemukan buku ! </br> ❌",l.style.marginTop="50px",l.style.textAlign="center",l.style.fontWeight="bold",l.style.color="red",t.append(l),a=!1}}function getBook(e){let t=document.getElementsByName("saveButton")[0],a=document.getElementById("inputJudul"),n=document.getElementById("inputPenulis"),i=document.getElementById("inputTahun"),o=findBookIndex(e),l=books[o].title,s=books[o].author,u=books[o].year,d=books[o].isCompleted;a.value=l,n.value=s,i.value=u,d?document.getElementById("inputComplete").checked=!0:document.getElementById("inputUncomplete").checked=!0,t.value="Edit Buku"}document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("form");if(isStorageExist()&&loadDataFromStorage(),null!=e){let t=new URLSearchParams(document.location.search);t.has("book")?(getBook(parseInt(t.get("book"))),e.addEventListener("submit",e=>{e.preventDefault(),editBook(parseInt(t.get("book")))})):e.addEventListener("submit",e=>{e.preventDefault(),addBook()})}}),document.getElementById("searchInput").addEventListener("keyup",e=>{e.preventDefault(),searchBook()}),document.getElementById("searchSubmit").addEventListener("submit",e=>{e.preventDefault(),searchBook()}),document.addEventListener(RENDER_EVENT,()=>{let e=document.getElementsByClassName("book-item")[0];if(e.innerHTML="",0==books.length){let t=document.getElementsByClassName("book-item")[0],a=document.createElement("h3");a.innerHTML="Isi buku terlebih dahulu ! </br> \uD83D\uDCDA\uD83D\uDCDA\uD83D\uDCDA",a.style.marginTop="50px",a.style.textAlign="center",a.style.fontWeight="bold",a.style.color="#263179",t.append(a)}for(let n of books){let i=manipulateBook(n);e.append(i)}});